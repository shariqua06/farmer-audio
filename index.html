<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farmer Subsidy Application – Voice AI</title>
<link href="https://fonts.googleapis.com/css2?family=Material+Icons&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Inter',Arial,sans-serif;background:linear-gradient(135deg,#f7e0ff 0%,#f0d4ff 100%);color:#1e2539;min-height:100vh;margin:0;display:flex;align-items:center;justify-content:center;}
.container{background:#fff;border-radius:20px;width:100%;max-width:520px;padding:28px 20px 38px;box-shadow:0 8px 32px rgba(112,144,176,0.18);}
h2{text-align:center;color:#7c3aed;margin-bottom:.35em;letter-spacing:1.2px;}
.subtitle{text-align:center;color:#888da8;font-size:1rem;margin:0 0 16px 0;}
#progressBar{width:100%;height:7px;background:#f1f5f9;border-radius:8px;margin:12px 0 20px;overflow:hidden;}
#progressBar span{display:block;height:100%;background:linear-gradient(90deg,#a78bfa,#f472b6);width:0%;transition:width .4s;}
.field-label{font-weight:600;font-size:1.03em;margin-bottom:4px;display:flex;align-items:center;gap:7px;}
input,select{width:100%;border:2px solid #e3e7f4;background:#fafdff;font-size:1em;border-radius:11px;padding:12px 14px;margin-bottom:10px;transition:border .2s;}
input:focus,select:focus{border-color:#7c3aed;outline:none;background:#f6fafd;box-shadow:0 2px 8px rgba(120,130,255,0.12);}
.field-row{display:flex;gap:7px;margin-bottom:10px;align-items:flex-start;position:relative;}
.icon{font-family:'Material Icons';font-weight:normal;font-style:normal;font-size:1.35em;color:#7c3aed;vertical-align:bottom;}
.voice-btn{background:#ebe6ff;color:#523ae8;border-radius:50%;width:50px;height:50px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:28px;margin-left:7px;transition:all .2s;}
.voice-btn.listening{box-shadow:0 0 12px #7c3aed;animation:glow 1s infinite alternate;}
@keyframes glow{0%{box-shadow:0 0 4px #7c3aed;}100%{box-shadow:0 0 16px #a78bfa;}}
.voice-btn:disabled{opacity:.5;cursor:not-allowed;}
.numeric-keypad{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px;}
.numeric-keypad button{flex:1 0 22%;padding:12px;font-size:1.1em;border-radius:6px;border:1px solid #ccc;background:#f0f0ff;cursor:pointer;}
.numeric-keypad button:active{background:#d0d0ff;}
#video{width:100%;border-radius:14px;margin-top:10px;margin-bottom:10px;background:#eee;min-height:140px;object-fit:cover;border:2px solid #e0e7ff;}
#aadhaarNumber[readonly]{font-weight:600;background:#f4f8ff;}
.submit-btn{width:100%;padding:13px;color:#fff;background:#7c3aed;border-radius:12px;border:none;font-size:1.1em;font-weight:700;margin-top:18px;cursor:pointer;}
.submit-btn:hover{background:#9333ea;}
#successTick{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:80px;color:#16a34a;z-index:9999;}
</style>
</head>
<body>
<div class="container">
<h2>Farmer Subsidy Application</h2>
<div class="subtitle">Voice + Camera + Numeric Input. Tamil & English prompts included.</div>
<div id="progressBar"><span></span></div>
<form id="form" autocomplete="off">

<!-- Name -->
<div class="field-row">
  <div style="flex:1;">
    <label class="field-label"><span class="icon">person</span>Name</label>
    <input id="name" placeholder="Enter Name">
  </div>
  <button type="button" class="voice-btn" id="voiceName"><span class="icon">mic</span></button>
</div>

<!-- Farm Location -->
<div class="field-row">
  <div style="flex:1;">
    <label class="field-label"><span class="icon">location_on</span>Farm Location</label>
    <input id="location" placeholder="Enter Location">
  </div>
  <button type="button" class="voice-btn" id="voiceLocation"><span class="icon">mic</span></button>
</div>

<!-- Subsidy Type -->
<div class="field-row">
  <div style="flex:1;">
    <label class="field-label"><span class="icon">agriculture</span>Subsidy Type</label>
    <select id="subsidyType">
      <option value="">-- Select Subsidy --</option>
      <option value="urimam">Urimam</option>
      <option value="parivu">Parivu</option>
      <option value="vidhai">Vidhai</option>
      <option value="ubagaranam">Ubagaranam</option>
    </select>
  </div>
  <button type="button" class="voice-btn" id="voiceSubsidy"><span class="icon">mic</span></button>
</div>

<!-- Amount -->
<div class="field-row">
  <div style="flex:1;">
    <label class="field-label"><span class="icon">payments</span>Amount</label>
    <input id="amount" placeholder="Enter Amount">
    <div class="numeric-keypad" id="amountKeypad"></div>
  </div>
  <button type="button" class="voice-btn" id="voiceAmount"><span class="icon">mic</span></button>
</div>
<!-- Aadhaar -->
<div class="field-row">
  <div style="flex:1;">
    <label class="field-label"><span class="icon">credit_card</span>Aadhaar Number</label>
    <input id="aadhaarNumber" placeholder="XXXX XXXX XXXX" readonly maxlength="14">
    <div class="numeric-keypad" id="aadhaarKeypad"></div>
  </div>
</div>

<!-- Camera -->
<div class="field-row">
  <video id="video" autoplay muted playsinline></video>
</div>

<button type="submit" class="submit-btn">Submit Form</button>
</form>
<div id="successTick">✔</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.4.0/dist/tesseract.min.js"></script>
<script>
// ===== Elements =====
const nameInput = document.getElementById('name');
const locationInput = document.getElementById('location');
const subsidyInput = document.getElementById('subsidyType');
const amountInput = document.getElementById('amount');
const aadhaarInput = document.getElementById('aadhaarNumber');
const aadhaarKeypad = document.getElementById('aadhaarKeypad');
const amountKeypad = document.getElementById('amountKeypad');
const progressBar = document.querySelector('#progressBar span');

// ===== Progress update =====
function updateProgress(){
  let filled=0;
  if(nameInput.value.trim()) filled++;
  if(locationInput.value.trim()) filled++;
  if(subsidyInput.value) filled++;
  if(amountInput.value.trim()) filled++;
  if(aadhaarInput.value.replace(/\s/g,'').length===12) filled++;
  progressBar.style.width = (filled/5*100)+'%';
}
[nameInput, locationInput, subsidyInput, amountInput, aadhaarInput].forEach(inp=>inp.addEventListener('input', updateProgress));

// ===== Aadhaar keypad =====
for(let i=1;i<=9;i++){ let b=document.createElement('button'); b.type='button'; b.textContent=i; b.onclick=()=>appendAadhaar(i); aadhaarKeypad.appendChild(b);}
let b0=document.createElement('button'); b0.type='button'; b0.textContent='0'; b0.onclick=()=>appendAadhaar(0); aadhaarKeypad.appendChild(b0);
let bDel=document.createElement('button'); bDel.type='button'; bDel.textContent='⌫'; bDel.onclick=()=>removeAadhaar(); aadhaarKeypad.appendChild(bDel);

function appendAadhaar(d){
  let val=aadhaarInput.value.replace(/\D/g,'');
  if(val.length>=12) return;
  val+=d;
  aadhaarInput.value = val.replace(/(\d{4})(?=\d)/g,'$1 ');
  updateProgress();
}
function removeAadhaar(){
  let val=aadhaarInput.value.replace(/\D/g,'');
  val = val.slice(0,-1);
  aadhaarInput.value = val.replace(/(\d{4})(?=\d)/g,'$1 ');
  updateProgress();
}

// ===== Amount keypad =====
for(let i=1;i<=9;i++){ let b=document.createElement('button'); b.type='button'; b.textContent=i; b.onclick=()=>appendAmount(i); amountKeypad.appendChild(b);}
let a0=document.createElement('button'); a0.type='button'; a0.textContent='0'; a0.onclick=()=>appendAmount(0); amountKeypad.appendChild(a0);
let aDel=document.createElement('button'); aDel.type='button'; aDel.textContent='⌫'; aDel.onclick=()=>removeAmount(); amountKeypad.appendChild(aDel);
function appendAmount(d){ amountInput.value+=d; updateProgress(); }
function removeAmount(){ amountInput.value=amountInput.value.slice(0,-1); updateProgress(); }

// ===== Camera OCR (optional) =====
const video = document.getElementById('video');
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
let ocrWorker;
(async function(){
  ocrWorker = Tesseract.createWorker({logger:m=>console.log(m)});
  await ocrWorker.load(); await ocrWorker.loadLanguage('eng'); await ocrWorker.initialize('eng');
})();
navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{video.srcObject=stream;});

// ===== Tamil + English audio URLs =====
const tamilAudios = {
  name:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/name.mp3',
  location:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/farmlocation.mp3',
  subsidy:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/type.mp3',
  amount:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/amount.mp3',
  aadhaar:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/aadhar.mp3',
  afterAadhaar:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/after-aadhar.mp3'
};
const englishAudios = {
  name:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/name_en.mp3',
  location:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/location_en.mp3',
  subsidy:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/type_en.mp3',
  amount:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/amount_en.mp3',
  aadhaar:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/aadhar_en.mp3',
  afterAadhaar:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/after-aadhar_en.mp3'
};

// ===== Voice recognition helper =====
function playTamilThenEnglish(tamilUrl, englishUrl, callback){
  const t=new Audio(tamilUrl); t.play();
  t.onended=()=>{
    const e=new Audio(englishUrl); e.play();
    e.onended = callback;
  }
}
function startRecognition(field, map={}){
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang='en-IN'; recognition.interimResults=false; recognition.maxAlternatives=1;
  recognition.onresult=e=>{
    let val = e.results[0][0].transcript.trim().toLowerCase();
    if(map[val]) val = map[val];
    document.getElementById(field).value = val;
    updateProgress();
    if(field==='subsidyType') {
      const label = document.getElementById('subsidyType').selectedOptions[0].text;
      const utter = new SpeechSynthesisUtterance('You selected '+label); utter.lang='en-IN'; speechSynthesis.speak(utter);
    }
  };
  recognition.onerror=()=>{};
  recognition.start();
}

// ===== Voice buttons =====
document.getElementById('voiceName').onclick = ()=>playTamilThenEnglish(tamilAudios.name, englishAudios.name, ()=>startRecognition('name'));
document.getElementById('voiceLocation').onclick = ()=>playTamilThenEnglish(tamilAudios.location, englishAudios.location, ()=>startRecognition('location'));
document.getElementById('voiceAmount').onclick = ()=>playTamilThenEnglish(tamilAudios.amount, englishAudios.amount, ()=>startRecognition('amount'));
document.getElementById('voiceSubsidy').onclick = ()=>playTamilThenEnglish(tamilAudios.subsidy, englishAudios.subsidy, ()=>startRecognition('subsidyType',{
  'urimam':'urimam','parivu':'parivu','vidhai':'vidhai','ubagaranam':'ubagaranam'
}));

// ===== After Aadhaar input (optional) =====
aadhaarInput.addEventListener('input',()=>{
  if(aadhaarInput.value.replace(/\s/g,'').length===12){
    playTamilThenEnglish(tamilAudios.afterAadhaar, englishAudios.afterAadhaar, ()=>{});
  }
});

// ===== Form submission =====
document.getElementById('form').onsubmit = function(e){
  e.preventDefault();
  if(aadhaarInput.value.replace(/\s/g,'').length!==12){alert('Complete Aadhaar!'); return;}
  if(!nameInput.value||!locationInput.value||!amountInput.value||!subsidyInput.value){alert('Fill all fields!'); return;}
  document.getElementById('successTick').style.display='block';
  setTimeout(()=>document.getElementById('successTick').style.display='none',1500);
  alert(
    `Form Submitted ✅
Name: ${nameInput.value}
Location: ${locationInput.value}
Subsidy: ${subsidyInput.value}
Amount: ${amountInput.value}
Aadhaar: ${aadhaarInput.value}`
  );
  document.getElementById('form').reset();
  updateProgress();
};
</script>
