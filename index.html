<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farmer Subsidy Application – AI Form Filler</title>
<link href="https://fonts.googleapis.com/css2?family=Material+Icons&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Inter',Arial,sans-serif;background:linear-gradient(135deg,#f3e8ff 0%,#f9f5ff 100%);color:#1e2539;min-height:100vh;margin:0;display:flex;align-items:center;justify-content:center;}
.container{background:#fff;border-radius:20px;width:100%;max-width:520px;padding:28px 14px 38px 14px;box-shadow:0 10px 40px rgba(112,144,176,0.2);}
h2{text-align:center;color:#8b5cf6;margin-bottom:.35em;letter-spacing:1.2px;}
.subtitle{text-align:center;color:#888da8;font-size:1rem;margin:0 0 16px 0;}
#progressBar{width:100%;height:7px;background:#f1f5f9;border-radius:8px;margin:12px 0 20px;overflow:hidden;}
#progressBar span{display:block;height:100%;background:linear-gradient(90deg,#a78bfa,#ec4899);width:0%;transition:width .4s;}
.field-label{font-weight:600;font-size:1.03em;margin-bottom:4px;display:flex;align-items:center;gap:7px;}
input,select{width:100%;border:2px solid #e3e7f4;background:#fafdff;font-size:1em;border-radius:11px;padding:12px 14px;margin-bottom:10px;transition:border .2s;}
input:focus,select:focus{border-color:#8b5cf6;outline:none;background:#f6fafd;box-shadow:0 2px 8px rgba(120,130,255,0.12);}
.field-row{display:flex;gap:7px;margin-bottom:8px;align-items:flex-start;}
.icon{font-family:'Material Icons';font-weight:normal;font-style:normal;font-size:1.35em;color:#ec4899;vertical-align:bottom;}
.voice-btn{background:#ede9fe;color:#8b5cf6;border-radius:50%;padding:.5em;width:50px;height:50px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:28px;margin-left:7px;position:relative;transition:background .2s;}
.voice-btn.listening{box-shadow:0 0 10px #ec4899; animation:glow 1s infinite alternate;}
@keyframes glow{0%{box-shadow:0 0 5px #ec4899;}100%{box-shadow:0 0 20px #ec4899;}}
#video{width:100%;border-radius:14px;margin-top:10px;margin-bottom:6px;background:#eee;min-height:135px;object-fit:cover;border:2px solid #e0e7ff;}
#aadhaarNumber[readonly]{font-weight:600;background:#f4f8ff;}
.submit-btn{width:100%;padding:13px;color:#fff;background:#8b5cf6;border-radius:12px;border:none;font-size:1.1em;font-weight:700;margin-top:18px;cursor:pointer;}
.submit-btn:hover{background:#ec4899;}
.numeric-keypad{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px;}
.numeric-keypad button{flex:1 0 22%;padding:12px;font-size:1.1em;border-radius:6px;border:1px solid #ccc;background:#f0f0ff;cursor:pointer;}
.numeric-keypad button:active{background:#d0d0ff;}
#successTick{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:80px;color:#16a34a;z-index:9999;}
#listeningIndicator{display:none;position:absolute;width:20px;height:20px;border-radius:50%;background:#ec4899;top:8px;right:8px;}
@media(max-width:520px){.container{max-width:97vw;padding:10px;border-radius:12px;}#video{min-height:80px;}.voice-btn{width:45px;height:45px;font-size:24px;}}
</style>
</head>
<body>
<div class="container">
<h2>Farmer Subsidy Application</h2>
<div class="subtitle">Voice + Camera + Numeric Input. Tamil & English prompts included.</div>
<div id="progressBar"><span></span></div>
<form id="form" autocomplete="off">
<div class="field-row">
<div style="flex:1;"><label class="field-label" for="name"><span class="icon">person</span>Name</label><input id="name" placeholder="Enter Name"></div>
<button type="button" class="voice-btn" id="voiceName"><span class="icon">mic</span></button>
</div>
<div class="field-row">
<div style="flex:1;"><label class="field-label" for="location"><span class="icon">location_on</span>Farm Location</label><input id="location" placeholder="Enter Location"></div>
<button type="button" class="voice-btn" id="voiceLocation"><span class="icon">mic</span></button>
</div>
<div class="field-row">
<div style="flex:1;"><label class="field-label" for="subsidyType"><span class="icon">agriculture</span>Subsidy Type</label>
<select id="subsidyType"><option value="">-- Select Subsidy --</option><option value="urimam">Urimam</option><option value="parivu">Parivu</option><option value="vidhai">Vidhai</option><option value="ubagaranam">Ubagaranam</option></select></div>
<button type="button" class="voice-btn" id="voiceSubsidy"><span class="icon">mic</span></button>
</div>
<div class="field-row">
<div style="flex:1;"><label class="field-label" for="amount"><span class="icon">payments</span>Amount</label><input id="amount" placeholder="Enter Amount" pattern="[0-9]*"><div class="numeric-keypad" id="amountKeypad"></div></div>
<button type="button" class="voice-btn" id="voiceAmount"><span class="icon">mic</span></button>
</div>
<div class="field-row">
<div style="flex:1;"><label class="field-label" for="aadhaarNumber"><span class="icon">credit_card</span>Aadhaar Card</label>
<div class="numeric-keypad" id="aadhaarKeypad"></div>
<video id="video" autoplay muted playsinline></video>
<div class="hint" id="cameraHint"><span class="icon">fact_check</span>Hold card steady, auto-fill Aadhaar.</div>
<input id="aadhaarNumber" placeholder="Aadhaar Number auto-filled" readonly>
<div class="hint" id="bankLink" style="color:#15803d; display:none;"><span class="icon">check_circle</span>Bank linked (dummy)</div></div>
<button type="button" class="voice-btn" id="voiceAadhaar"><span class="icon">mic</span></button>
</div>
<button type="submit" id="submitBtn" class="submit-btn" disabled>Submit Form</button>
<div id="successTick">✔</div>
</form>
</div>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.4.0/dist/tesseract.min.js"></script>
<script>
// ===== PROGRESS BAR =====
function setProgress(val){
    document.querySelector("#progressBar span").style.width = val + "%";
}
["name","location","subsidyType","amount","aadhaarNumber"].forEach((id,i)=>{
    document.getElementById(id).addEventListener("focus",()=>setProgress((i+1)*20));
});

// ===== OCR (Aadhaar) =====
const video = document.getElementById("video");
const aadhaarInput = document.getElementById("aadhaarNumber");
const bankLink = document.getElementById("bankLink");
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");
let ocrWorker;
async function initOCR(){
    ocrWorker = Tesseract.createWorker({logger:m=>console.log(m)});
    await ocrWorker.load();
    await ocrWorker.loadLanguage('eng');
    await ocrWorker.initialize('eng');
}
initOCR();

async function startCamera(){
    try{
        const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
        video.srcObject = stream;
        video.play();
    }catch(e){console.warn(e);}
}
startCamera();

async function scanFrame(){
    if(video.readyState === 4 && ocrWorker){
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video,0,0,canvas.width,canvas.height);
        const {data} = await ocrWorker.recognize(canvas);
        const match = data.text.match(/\b\d{4}\s*\d{4}\s*\d{4}\b/);
        if(match){
            let formatted = match[0].replace(/\s/g,"");
            formatted = formatted.match(/.{1,4}/g).join(" ");
            aadhaarInput.value = formatted;
            bankLink.style.display="block";
        }
    }
    requestAnimationFrame(scanFrame);
}
scanFrame();

// ===== NUMERIC KEYPAD =====
function createKeypad(containerId,inputField,spaceEvery=0){
    const container = document.getElementById(containerId);
    [1,2,3,4,5,6,7,8,9,0].forEach(n=>{
        const btn = document.createElement("button");
        btn.type="button";
        btn.textContent = n;
        btn.onclick=()=>{
            let val = inputField.value.replace(/\s/g,"") + n;
            if(spaceEvery>0){
                inputField.value = val.match(new RegExp('.{1,'+spaceEvery+'}', 'g')).join(" ");
            } else {
                inputField.value = val;
            }
        };
        container.appendChild(btn);
    });
}
createKeypad("amountKeypad",document.getElementById("amount"),0);
createKeypad("aadhaarKeypad",aadhaarInput,4);

// ===== VOICE SEQUENCES =====
const tamilAudios = {
    name:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/name.mp3',
    location:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/farmlocation.mp3',
    subsidyType:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/type.mp3',
    amount:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/amount.mp3',
    aadhaar:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/aadhar.mp3',
    afterAadhaar:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/after-aadhar.mp3'
};

const englishAudios = {
    name:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/name_en.mp3',
    location:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/location_en.mp3',
    subsidyType:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/type_en.mp3',
    amount:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/amount_en.mp3',
    aadhaar:'Details have been fetched from the bank account linked to this Aadhaar.'
};

function glowMic(btn,on=true){
    if(on) btn.classList.add("listening");
    else btn.classList.remove("listening");
}

function playAudioSequence(field,mapValues={},isSubsidy=false){
    const btn = document.getElementById("voice"+field.charAt(0).toUpperCase()+field.slice(1));
    btn.disabled=true;
    glowMic(btn,true);

    const tamilAudio = new Audio(tamilAudios[field]);
    tamilAudio.play();
    tamilAudio.onended=()=>{
        if(field !== "aadhaar"){
            // English TTS
            let enAudio;
            if(field==="subsidyType"){
                enAudio = new Audio(englishAudios.subsidyType);
            } else {
                enAudio = new Audio(englishAudios[field]);
            }
            enAudio.play();
            enAudio.onended = ()=>startRecognition(field,mapValues,btn,isSubsidy);
        } else {
            // After Aadhaar
            const afterAadhaar = new Audio(tamilAudios.afterAadhaar);
            afterAadhaar.play();
            afterAadhaar.onended = ()=>{
                // English TTS after Aadhaar
                const synth = window.speechSynthesis;
                const utter = new SpeechSynthesisUtterance(englishAudios.aadhaar);
                synth.speak(utter);
                utter.onend = ()=>{
                    btn.disabled=false; glowMic(btn,false);
                    checkAllFilled();
                };
            };
        }
    };
}

function startRecognition(field,mapValues,btn,isSubsidy=false){
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-IN';
    recognition.interimResults=false;
    recognition.maxAlternatives=1;

    recognition.onresult = e=>{
        let text = e.results[0][0].transcript.trim().toLowerCase();
        if(mapValues[text]) text=mapValues[text];
        document.getElementById(field).value = text;
        btn.disabled=false; glowMic(btn,false);
        checkAllFilled();
    };
    recognition.onerror = ()=>{
        btn.disabled=false; glowMic(btn,false);
    };
    recognition.start();
}

// ===== FIELD VOICE BUTTONS =====
document.getElementById("voiceName").onclick = ()=>playAudioSequence("name");
document.getElementById("voiceLocation").onclick = ()=>playAudioSequence("location");
document.getElementById("voiceAmount").onclick = ()=>playAudioSequence("amount");
document.getElementById("voiceAadhaar").onclick = ()=>playAudioSequence("aadhaar");
document.getElementById("voiceSubsidy").onclick = ()=>{
    playAudioSequence("subsidyType",{urimam:"urimam",parivu:"parivu",vidhai:"vidhai",ubagaranam:"ubagaranam"},true);
};

// ===== CHECK ALL FIELDS FILLED =====
function checkAllFilled(){
    const allFilled = ['name','location','subsidyType','amount','aadhaarNumber'].every(id=>document.getElementById(id).value);
    document.getElementById("submitBtn").disabled = !allFilled;
    if(allFilled){
        document.getElementById("successTick").style.display='block';
        setTimeout(()=>{document.getElementById("successTick").style.display='none';},2500);
    }
}

// ===== FORM SUBMIT =====
document.getElementById("form").onsubmit = e=>{
    e.preventDefault();
    alert("Form Submitted!\nName: "+document.getElementById('name').value+
          "\nLocation: "+document.getElementById('location').value+
          "\nSubsidy: "+document.getElementById('subsidyType').value+
          "\nAmount: "+document.getElementById('amount').value+
          "\nAadhaar: "+document.getElementById('aadhaarNumber').value+
          "\nBank linked (dummy) ✅");
    document.getElementById("form").reset();
    setProgress(0);
    bankLink.style.display="none";
    document.getElementById("submitBtn").disabled=true;
};
</script>

