<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farmer Subsidy Application â€“ AI Form Filler</title>
<link href="https://fonts.googleapis.com/css2?family=Material+Icons&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== BASIC STYLING ===== */
body {
  font-family: 'Inter', Arial, sans-serif;
  background: linear-gradient(135deg, #f7ffe0 0%, #e0e7ff 100%);
  color: #1e2539;
  min-height: 100vh;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.container {
  background: #fff;
  border-radius: 20px;
  width: 100%;
  max-width: 520px;
  padding: 28px 14px 38px 14px;
  box-shadow: 0 8px 32px 0 rgba(112, 144, 176, 0.18);
}
h2 { text-align:center; color:#4f46e5; margin-bottom:0.35em; letter-spacing:1.2px;}
.subtitle { text-align:center; color:#888da8; font-size:1rem; margin:0 0 16px 0;}
#progressBar {width:100%; height:7px; background:#f1f5f9; border-radius:8px; margin:12px 0 20px; overflow:hidden;}
#progressBar span {display:block; height:100%; background:linear-gradient(90deg,#7a88ff,#48bee5); width:0%; transition:width 0.4s;}
.field-label { font-weight:600; font-size:1.03em; margin-bottom:4px; display:flex; align-items:center; gap:7px;}
input, select { width:100%; border:2px solid #e3e7f4; background:#fafdff; font-size:1em; border-radius:11px; padding:12px 14px; margin-bottom:10px; transition:border 0.2s;}
input:focus, select:focus { border-color:#7a88ff; outline:none; background:#f6fafd; box-shadow:0 2px 8px rgba(120,130,255,0.12);}
.field-row { display:flex; gap:7px; margin-bottom:8px; align-items:flex-start;}
.icon { font-family:'Material Icons'; font-weight:normal; font-style:normal; font-size:1.35em; color:#48bee5; vertical-align:bottom;}
.voice-btn { background:#ebe6ff; color:#523ae8; border-radius:50%; padding:0.5em; width:50px; height:50px; border:none; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:28px; margin-left:7px; position:relative; transition:background 0.2s;}
.voice-btn.recording::after { content:''; position:absolute; width:16px; height:16px; background:#e53935; border-radius:50%; top:4px; right:4px; box-shadow:0 0 8px #e53935; animation:pulse 1s infinite;}
.voice-btn:disabled { opacity:0.5; cursor:not-allowed;}
.hint { font-size:0.96em; color:#96a1be; margin-top:3px; margin-bottom:7px; display:flex; gap:6px; align-items:center;}
#video { width:100%; border-radius:14px; margin-top:10px; margin-bottom:6px; background:#eee; min-height:135px; object-fit:cover; border:2px solid #e0e7ff;}
#aadhaarNumber[readonly] { font-weight:600; background:#f4f8ff;}
.submit-btn { width:100%; padding:13px; color:#fff; background:#4f46e5; border-radius:12px; border:none; font-size:1.1em; font-weight:700; margin-top:18px; cursor:pointer;}
.submit-btn:hover { background:#644bfd;}
.numeric-keypad { display:flex; flex-wrap:wrap; gap:4px; margin-bottom:10px;}
.numeric-keypad button { flex:1 0 22%; padding:12px; font-size:1.1em; border-radius:6px; border:1px solid #ccc; background:#f0f0ff; cursor:pointer;}
.numeric-keypad button:active { background:#d0d0ff;}
#successTick {display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:80px; color:#16a34a; z-index:9999;}
#listeningMic {display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:100px; height:100px; border-radius:50%; background:#4f46e5; display:flex; align-items:center; justify-content:center; color:#fff; font-size:40px; z-index:10000; box-shadow:0 0 20px rgba(0,0,0,0.3); animation:micPulse 1s infinite;}
@keyframes micPulse {0%{transform:scale(0.9);}50%{transform:scale(1.1);}100%{transform:scale(0.9);}}
@media(max-width:520px){.container{max-width:97vw;padding:10px;border-radius:12px;}#video{min-height:80px;}.voice-btn{width:45px;height:45px;font-size:24px;}}
</style>
</head>
<body>
<div class="container">
<h2>Farmer Subsidy Application</h2>
<div class="subtitle">Voice + Camera + Numeric Input. Tamil prompts included.</div>
<div id="progressBar"><span></span></div>
<form id="form" autocomplete="off">

<!-- Name -->
<div class="field-row">
<div style="flex:1;">
<label class="field-label" for="name"><span class="icon">person</span>Name</label>
<input id="name" placeholder="Enter Name">
</div>
<button type="button" class="voice-btn" id="voiceName"><span class="icon">mic</span></button>
</div>

<!-- Location -->
<div class="field-row">
<div style="flex:1;">
<label class="field-label" for="location"><span class="icon">location_on</span>Farm Location</label>
<input id="location" placeholder="Enter Location">
</div>
<button type="button" class="voice-btn" id="voiceLocation"><span class="icon">mic</span></button>
</div>

<!-- Subsidy -->
<div class="field-row">
<div style="flex:1;">
<label class="field-label" for="subsidyType"><span class="icon">agriculture</span>Subsidy Type</label>
<select id="subsidyType">
<option value="">-- Select Subsidy --</option>
<option value="urimam">Urimam (Fertilizer)</option>
<option value="parivu">Parivu (Irrigation)</option>
<option value="vidhai">Vidhai (Seed)</option>
<option value="ubagaranam">Ubagaranam (Equipment)</option>
</select>
</div>
<button type="button" class="voice-btn" id="voiceSubsidy"><span class="icon">mic</span></button>
</div>

<!-- Amount -->
<div class="field-row">
<div style="flex:1;">
<label class="field-label" for="amount"><span class="icon">payments</span>Amount</label>
<input id="amount" placeholder="Enter Amount" pattern="[0-9]*">
<div class="numeric-keypad" id="numericKeypad"></div>
</div>
<button type="button" class="voice-btn" id="voiceAmount"><span class="icon">mic</span></button>
</div>

<!-- Aadhaar -->
<div style="margin-top:17px;">
<label class="field-label" for="aadhaarNumber"><span class="icon">credit_card</span>Aadhaar Card</label>
<video id="video" autoplay muted playsinline></video>
<div class="hint" id="cameraHint"><span class="icon">fact_check</span>Hold card steady, auto-fill Aadhaar.</div>
<input id="aadhaarNumber" placeholder="Aadhaar Number auto-filled" readonly>
<div class="hint" id="bankLink" style="color:#15803d; display:none;"><span class="icon">check_circle</span>Bank linked (dummy)</div>
</div>

<button type="submit" class="submit-btn">Submit Form</button>
</form>
<div id="successTick">âœ”</div>
<div id="listeningMic">ðŸŽ¤</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.4.0/dist/tesseract.min.js"></script>
<script>
/* ===== PROGRESS BAR ===== */
function setProgress(val){document.querySelector("#progressBar span").style.width=val+"%";}
["name","location","subsidyType","amount","aadhaarNumber"].forEach((id,i)=>{
  document.getElementById(id).addEventListener("focus",()=>setProgress((i+1)*20));
});

/* ===== CAMERA + OCR ===== */
const video=document.getElementById("video");
const aadhaarInput=document.getElementById("aadhaarNumber");
const bankLink=document.getElementById("bankLink");
const canvas=document.createElement("canvas");
const ctx=canvas.getContext("2d");
let ocrWorker;
async function initOCR(){
  ocrWorker=Tesseract.createWorker({logger:m=>console.log(m)});
  await ocrWorker.load();
  await ocrWorker.loadLanguage('eng');
  await ocrWorker.initialize('eng');
}
initOCR();
async function startCamera(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
    video.srcObject=stream;
    video.play();
  }catch(e){ console.warn("Camera error",e); }
}
startCamera();
async function scanFrame(){
  if(video.readyState===4 && ocrWorker){
    canvas.width=video.videoWidth;
    canvas.height=video.videoHeight;
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const {data}=await ocrWorker.recognize(canvas);
    const match=data.text.match(/\b\d{4}\s*\d{4}\s*\d{4}\b/);
    if(match){ aadhaarInput.value=match[0].replace(/\s/g,""); bankLink.style.display="block"; }
  }
  requestAnimationFrame(scanFrame);
}
scanFrame();

/* ===== NUMERIC KEYPAD ===== */
const keypadContainer=document.getElementById("numericKeypad");
const amountInput=document.getElementById("amount");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
  const btn=document.createElement("button");
  btn.type="button"; btn.textContent=n;
  btn.onclick=()=>{amountInput.value+=n;};
  keypadContainer.appendChild(btn);
});

/* ===== VOICE INPUT WITH TAMIL + ENGLISH ===== */
const tamilAudios={
  name:{tamil:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/name.mp3', english:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/name_en.mp3'},
  location:{tamil:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/farmlocation.mp3', english:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/location_en.mp3'},
  subsidyType:{tamil:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/type.mp3', english:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/type_en.mp3'},
  amount:{tamil:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/amount.mp3', english:'https://raw.githubusercontent.com/shariqua06/farmer-audio/main/amount_en.mp3'}
};
const listeningMic=document.getElementById("listeningMic");

function disableOtherMics(activeBtn){
  document.querySelectorAll('.voice-btn').forEach(btn=>{ if(btn!==activeBtn) btn.disabled=true; });
}
function enableAllMics(){ document.querySelectorAll('.voice-btn').forEach(btn=>btn.disabled=false); }

function showSuccessTick(){
  const allFilled=['name','location','subsidyType','amount','aadhaarNumber'].every(id=>document.getElementById(id).value);
  if(allFilled){
    const tick=document.getElementById('successTick');
    tick.style.display='block';
    setTimeout(()=>{tick.style.display='none';},2500);
  }
}

function playTamilThenEnglishThenListen(field,mapValues={}){
  const btn=document.getElementById("voice"+field.charAt(0).toUpperCase()+field.slice(1));
  btn.disabled=true; btn.classList.add("recording");
  disableOtherMics(btn);

  // Play Tamil
  const tamilAudio=new Audio(tamilAudios[field].tamil);
  tamilAudio.play();
  tamilAudio.onended=()=>{
    // Play English
    const enAudio=new Audio(tamilAudios[field].english);
    enAudio.play();
    enAudio.onended=()=>{
      // Start recognition
      listeningMic.style.display='flex';
      const recognition=new (window.SpeechRecognition||window.webkitSpeechRecognition)();
      recognition.lang='en-IN';
      recognition.interimResults=false;
      recognition.maxAlternatives=1;
      recognition.onresult=e=>{
        let text=e.results[0][0].transcript.trim().toLowerCase();
        if(mapValues[text]) text=mapValues[text];
        document.getElementById(field).value=text;
        btn.disabled=false; btn.classList.remove("recording");
        listeningMic.style.display='none';
        enableAllMics();
        showSuccessTick();
      };
      recognition.onerror=()=>{ btn.disabled=false; btn.classList.remove("recording"); listeningMic.style.display='none'; enableAllMics(); };
      recognition.start();
    };
  };
}

// Assign voice buttons
document.getElementById("voiceName").onclick=()=>playTamilThenEnglishThenListen('name');
document.getElementById("voiceLocation").onclick=()=>playTamilThenEnglishThenListen('location');
document.getElementById("voiceSubsidy").onclick=()=>playTamilThenEnglishThenListen('subsidyType',{
  urimam:'urimam', parivu:'parivu', vidhai:'vidhai', ubagaranam:'ubagaranam'
});
document.getElementById("voiceAmount").onclick=()=>playTamilThenEnglishThenListen('amount');

/* ===== FORM SUBMIT ===== */
document.getElementById("form").onsubmit=function(e){
  e.preventDefault();
  let valid=true;
  ['name','location','subsidyType','amount','aadhaarNumber'].forEach(id=>{
    if(!document.getElementById(id).value){ valid=false; document.getElementById(id).style.borderColor="#ee2929"; setTimeout(()=>document.getElementById(id).style.borderColor="",1800);}
  });
  if(!valid){ alert("Please fill all fields."); return;}
  alert(
    "Form Submitted!\n"+
    "Name: "+document.getElementById('name').value+"\n"+
    "Location: "+document.getElementById('location').value+"\n"+
    "Subsidy: "+document.getElementById('subsidyType').value+"\n"+
    "Amount: "+document.getElementById('amount').value+"\n"+
    "Aadhaar: "+document.getElementById('aadhaarNumber').value+"\n"+
    "Bank linked (dummy) âœ…"
  );
  document.getElementById("form").reset();
  setProgress(0);
  bankLink.style.display="none";
};
</script>
</body>
</html>
